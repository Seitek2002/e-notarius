<template>
  <div>
    <div class="info__form">
      <div class="info__subject">
        <Suptitle text="Субъект" />
        <div class="flex">
          <div
            class="info__radio"
            @click="(isActiveRadio = 0), (INNVal = ''), (end = false);"
          >
            <div class="info__radio--button">
              <RadioCheckedIcon v-if="isActiveRadio === 0" />
              <RadioNulledIcon v-else />
            </div>
            Физическое лицо
          </div>
          <div
            class="info__radio"
            @click="(isActiveRadio = 1), (INNVal = ''), (end = false);"
          >
            <div class="info__radio--button">
              <RadioCheckedIcon v-if="isActiveRadio === 1" />
              <RadioNulledIcon v-else />
            </div>
            Юридическое лицо
          </div>
          <div
            class="info__radio"
            @click="(isActiveRadioFace = !isActiveRadioFace), (end = false)"
          >
            <div class="info__radio--button">
              <div class="radio" :class="{ active: isActiveRadioFace }">
                <RadioSuccesWhiteIcon v-if="isActiveRadioFace" />
                <div v-else class="radio-check" />
              </div>
            </div>
            Иностранное лицо
          </div>
        </div>
      </div>

      <Suptitle text="Личные данные" />
      <label>
        <p v-if="isActiveRadio === 0">Персональный номер (ИНН)</p>
        <p v-else>Идентификационный номер (ИНН)</p>
        <input v-model="INNVal" type="text" />
      </label>
      <div v-if="isActiveRadio === 0" class="face">
        <div class="info__profile">
          <div class="info__forms">
            <div class="info__form--wrapper">
              <label>
                <p>Фамилия</p>
                <input v-model="surname" type="text" />
              </label>
            </div>
            <div class="info__form--wrapper">
              <label>
                <p>Имя</p>
                <input v-model="name" type="text" />
              </label>
            </div>
            <div class="info__form--wrapper">
              <label>
                <p>Отчество</p>
                <input v-model="lastname" type="text" />
              </label>
            </div>
          </div>
        </div>

        <div class="info__form--wrapper flex jcsb aic" style="margin-top: 15px">
          <div class="info__subject">
            <p>Пол</p>
            <div class="flex">
              <div class="info__radio" @click="isActiveRadioSec = 0">
                <div class="info__radio--button">
                  <RadioCheckedIcon v-if="isActiveRadioSec === 0" />
                  <RadioNulledIcon v-else />
                </div>
                Мужской
              </div>
              <div class="info__radio" @click="isActiveRadioSec = 1">
                <div class="info__radio--button">
                  <RadioCheckedIcon v-if="isActiveRadioSec === 1" />
                  <RadioNulledIcon v-else />
                </div>
                Женский
              </div>
            </div>
          </div>
          <label class="w-33">
            <p>Дата рождения</p>
            <input v-model="dateOfBirthVal" type="text" />
          </label>
          <div class="w-50 dropdown-search">
            <p>Гражданство</p>
            <label
              ref="citizenshipIsActiveRef"
              :class="citizenshipIsActive ? 'active' : ''"
              @click="citizenshipIsActive = true"
            >
              <span>
                <SearchIcon />
                {{ citizenshipActiveOption }}
              </span>
              <ArrowDownSmallIcon />
            </label>
            <div v-show="citizenshipIsActive" class="dropdown__select">
              <div
                v-for="option in ['Кыргызстан']"
                :key="option"
                class="dropdown-search__option"
                @click="
                  (citizenshipActiveOption = option),
                    (citizenshipIsActive = false);
                "
              >
                {{ option }}
              </div>
            </div>
          </div>
        </div>
        <div class="info__form">
          <Suptitle text="Адрес прописки (регистрации)" />
          <div class="info__form--wrapper flex">
            <div class="w-55 dropdown">
              <p>Область</p>
              <label
                ref="regionIsActiveRef"
                :class="regionIsActive ? 'active' : ''"
                @click="regionIsActive = true"
              >
                <span>
                  {{ regionActiveOption }}
                </span>
                <ArrowDownSmallIcon />
              </label>
              <div v-show="regionIsActive" class="dropdown__select">
                <div
                  v-for="option in regionActiveOptions"
                  :key="option"
                  class="dropdown-search__option"
                  @click="
                    (regionActiveOption = option), (regionIsActive = false);
                  "
                >
                  {{ option }}
                </div>
              </div>
            </div>
            <div class="w-55 dropdown">
              <p>Районы</p>
              <label
                ref="areaIsActiveRef"
                :class="areaIsActive ? 'active' : ''"
                @click="areaIsActive = true"
              >
                <span>
                  {{ areaActiveOption }}
                </span>
                <ArrowDownSmallIcon />
              </label>
              <div v-show="areaIsActive" class="dropdown__select">
                <div
                  v-for="option in areasFirst"
                  :key="option"
                  class="dropdown-search__option"
                  @click="(areaActiveOption = option), (areaIsActive = false);"
                >
                  {{ option }}
                </div>
              </div>
            </div>
          </div>
          <div class="info__form--wrapper flex">
            <div class="city dropdown">
              <p>Населенный пункт, город</p>
              <label
                ref="cityIsActiveRef"
                :class="cityIsActive ? 'active' : ''"
                @click="cityIsActive = true"
              >
                <span>
                  {{ cityActiveOption }}
                </span>
                <ArrowDownSmallIcon />
              </label>
              <div v-show="cityIsActive" class="dropdown__select">
                <div
                  v-for="option in [
                    'г. Бишкек',
                    'г. Токмок',
                    'г. Ош',
                    'г. Жалал-Абад',
                    'г. Кочкор-Ата',
                    'г. Майлуу-Суу',
                    'г. Так-Комур',
                    'г. Кара-Куль',
                    'г. Талас',
                    'г. Баткен',
                    'г. Сулюкта',
                    'г. Кызыл-Кыя',
                    'г. Баткен',
                    'г. Чолпон-Ата',
                    'г. Балыкчы',
                    'г. Каракол',
                    'г. Нарын',
                  ]"
                  :key="option"
                  class="dropdown-search__option"
                  @click="(cityActiveOption = option), (cityIsActive = false);"
                >
                  {{ option }}
                </div>
              </div>
            </div>
            <label class="street">
              <p>Улица</p>
              <input v-model="streetFirst" type="text" />
            </label>
            <label class="home">
              <p>Дом</p>
              <input v-model="houseFirst" type="text" />
            </label>
            <label class="home">
              <p>Квартира</p>
              <input v-model="flatFirst" type="text" />
            </label>
          </div>
          <Suptitle text="Адрес фактического места жительства" />
          <div class="info__form--wrapper flex">
            <div class="w-55 dropdown">
              <p>Область</p>
              <label
                ref="regionIsActiveSecondRef"
                :class="regionIsActiveSecond ? 'active' : ''"
                @click="regionIsActiveSecond = true"
              >
                <span>
                  {{ regionActiveOptionSecond }}
                </span>
                <ArrowDownSmallIcon />
              </label>
              <div v-show="regionIsActiveSecond" class="dropdown__select">
                <div
                  v-for="option in regionActiveOptions"
                  :key="option"
                  class="dropdown-search__option"
                  @click="
                    (regionActiveOptionSecond = option),
                      (regionIsActiveSecond = false);
                  "
                >
                  {{ option }}
                </div>
              </div>
            </div>
            <div class="w-55 dropdown">
              <p>Районы</p>
              <label
                ref="areaIsActiveSecondRef"
                :class="areaIsActiveSecond ? 'active' : ''"
                @click="areaIsActiveSecond = true"
              >
                <span>
                  {{ areaActiveOptionSecond }}
                </span>
                <ArrowDownSmallIcon />
              </label>
              <div v-show="areaIsActiveSecond" class="dropdown__select">
                <div
                  v-for="option in areasSecond"
                  :key="option"
                  class="dropdown-search__option"
                  @click="
                    (areaActiveOptionSecond = option),
                      (areaIsActiveSecond = false);
                  "
                >
                  {{ option }}
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="info__form--wrapper" style="margin-top: 30px">
          <Suptitle text="Контактные данные" />
          <div class="flex" style="margin-top: 15px">
            <label class="w-55">
              <p>E-mail*</p>
              <input v-model="emailVal" type="text" />
            </label>
            <label class="w-55">
              <p>Номер телефона*</p>
              <input v-model="phoneVal" type="text" />
            </label>
          </div>
        </div>
      </div>

      <div v-if="isActiveRadio === 1" class="layer">
        <Suptitle class="data" text="Данные юридического лица" />
        <div class="info__form--wrapper">
          <label class="street">
            <p>Полное наименование на официальном языке</p>
            <input v-model="officialNameVal" type="text" />
          </label>
          <label class="home">
            <p>Полное наименование на государственном языке</p>
            <input v-model="nationalNameVal" type="text" />
          </label>
          <label class="home">
            <p>Есть ли иностранное участие</p>
            <input v-model="foreigParticipantVal" type="text" />
          </label>
          <label class="home">
            <p>Регистрационный номер</p>
            <input v-model="registryNumberVal" type="text" />
          </label>
          <label class="home">
            <p>Код ОКПО</p>
            <input v-model="okpoNumberVal" type="text" />
          </label>
          <label class="home">
            <p>ИНН</p>
            <input v-model="INNVal" type="text" />
          </label>
          <label class="home">
            <p>Дата приказа</p>
            <input v-model="orderDateVal" type="text" />
          </label>
          <label class="home">
            <p>Область</p>
            <input v-model="regionVal" type="text" />
          </label>
          <label class="home">
            <p>Район</p>
            <input v-model="areaVal" type="text" />
          </label>
          <label class="home">
            <p>Город/село/поселок</p>
            <input v-model="cityVal" type="text" />
          </label>
          <label class="home">
            <p>Улица (проекспект,бульвар, переулок и т.п.)</p>
            <input v-model="layerStreet" type="text" />
          </label>
          <label class="home">
            <p>№ Дома</p>
            <input v-model="layerHouse" type="text" />
          </label>
          <label class="home">
            <p>Руководитель</p>
            <input v-model="supervisorVal" type="text" />
          </label>
          <label class="home">
            <p>Кол-во учредителей (участников) физических лиц</p>
            <input v-model="foundersVal" type="text" />
          </label>
          <label class="home">
            <p>Кол-во учредителей (участников) юридических лиц</p>
            <input v-model="foundersLayerVal" type="text" />
          </label>
          <label class="home">
            <p>Общее кол-во (участников)</p>
            <input v-model="qntyOfMembersVal" type="text" />
          </label>
        </div>
      </div>
    </div>
    <div v-show="isActiveRadioFace" class="info__form">
      <Suptitle text="Документ, удостоверяющий личность" />
      <div class="info__form--wrapper">
        <label>
          <p>Наименование документа</p>
          <input type="text" placeholder="Паспорт" />
        </label>
      </div>
      <div class="info__form--wrapper flex">
        <div class="info__form--details">
          <p>Серия и № паспорта*</p>
          <div class="flex">
            <Dropdown title="" :options="['ID', 'AN', 'AC']" />
            <input type="text" />
          </div>
        </div>
        <div class="info__form--details">
          <p>Орган и дата выдачи</p>
          <div class="flex">
            <input type="text" />
            <input type="text" />
            от
            <input type="text" />
          </div>
        </div>
      </div>
    </div>
    <div class="info__form">
      <div class="info__form--wrapper">
        <File />
      </div>
    </div>
  </div>
</template>

<script setup>
import { ref, watch } from "vue";
import { useStore } from "vuex";
import ArrowDownSmallIcon from "@/components/global/UI/Info/Icons/ArrowDownSmallIcon.vue";
import RadioCheckedIcon from "@/components/global/UI/Info/Icons/RadioCheckedIcon.vue";
import RadioNulledIcon from "@/components/global/UI/Info/Icons/RadioNulledIcon.vue";
import RadioSuccesWhiteIcon from "@/components/global/UI/Info/Icons/RadioSuccesWhiteIcon.vue";
import SearchIcon from "@/components/global/UI/Info/Icons/SearchIcon.vue";
import Dropdown from "@/components/global/UI/Info/Dropdown.vue";
import Suptitle from "@/components/global/UI/Info/Suptitle.vue";
import File from "@/components/global/UI/Info/Input/File.vue";
import { onClickOutside } from "@vueuse/core";

const store = useStore();
const INNVal = ref("");
const surname = ref("");
const name = ref("");
const lastname = ref("");
const isLoading = ref(false);
const isErr = ref(false);

const data = ref({
  "г. Бишкек": [
    "Первомайский район",
    "Ленинский район",
    "Свердловский район",
    "Октябрьский район",
  ],
  Чуй: [
    "Ыссык-Атинский район",
    "Аламудунский район",
    "Сокулукский район",
    "Московский район",
    "Жайылский район",
    "Кеминский район",
    "Панфиловский район",
  ],
  Ош: [
    "Кара-Сууйский район",
    "Ноокатский район",
    "Узгенский район",
    "Араванский район",
    "Алайский район",
    "Кара-Кулжинский район",
    "Чон-Алайский район",
  ],
});

const regionActiveOptions = ref(Object.keys(data.value));

const officialNameVal = ref("");
const nationalNameVal = ref("");

const cityIsActive = ref(false);
const cityIsActiveRef = ref(null);
onClickOutside(cityIsActiveRef, () => (cityIsActive.value = false));
const cityActiveOption = ref("");

const citizenshipIsActive = ref(false);
const citizenshipIsActiveRef = ref(null);
onClickOutside(
  citizenshipIsActiveRef,
  () => (citizenshipIsActive.value = false)
);
const citizenshipActiveOption = ref("");

const regionIsActive = ref(false);
const regionIsActiveRef = ref(null);
onClickOutside(regionIsActiveRef, () => (regionIsActive.value = false));
const regionActiveOption = ref("");

const areaIsActive = ref(false);
const areaIsActiveRef = ref(null);
onClickOutside(areaIsActiveRef, () => (areaIsActive.value = false));
const areaActiveOption = ref("");

const regionIsActiveSecond = ref(false);
const regionIsActiveSecondRef = ref(null);
onClickOutside(
  regionIsActiveSecondRef,
  () => (regionIsActiveSecond.value = false)
);
const regionActiveOptionSecond = ref("");

const areaIsActiveSecond = ref(false);
const areaIsActiveSecondRef = ref(null);
onClickOutside(areaIsActiveSecondRef, () => (areaIsActiveSecond.value = false));
const areaActiveOptionSecond = ref("");

const streetFirst = ref("");
const houseFirst = ref("");
const flatFirst = ref("");

const streetSecond = ref("");
const houseSecond = ref("");
const flatSecond = ref("");

const dateOfBirthVal = ref("");
const emailVal = ref("");
const phoneVal = ref("");

const avatarImg = ref("");
const isActive = ref(false);
const isActiveRadio = ref(0);
const isActiveRadioSec = ref(0);
const isActiveRadioFace = ref(false);
const activeOption = ref("");

const fullNameVal = ref("");
const foreigParticipantVal = ref("");
const registryNumberVal = ref("");
const okpoNumberVal = ref("");
const orderDateVal = ref("");
const regionVal = ref("");
const areaVal = ref("");
const cityVal = ref("");

const layerStreet = ref("");
const layerHouse = ref("");

const supervisorVal = ref("");
const foundersVal = ref("");
const foundersLayerVal = ref("");
const qntyOfMembersVal = ref("");

const getUsers = () => {
  isLoading.value = true;
  isErr.value = false;
  surname.value = "";
  name.value = "";
  lastname.value = "";
  avatarImg.value = "";
  isLoading.value = "";
  streetSecond.value = "";
  houseSecond.value = "";
  flatSecond.value = "";
  streetFirst.value = "";
  houseFirst.value = "";
  flatFirst.value = "";
  citizenshipActiveOption.value = "";
  regionActiveOption.value = "";
  regionActiveOptionSecond.value = "";
  areaActiveOption.value = "";
  areaActiveOptionSecond.value = "";
  dateOfBirthVal.value = "";
  emailVal.value = "";
  phoneVal.value = "";

  if (INNVal.value.trim() !== "") {
    try {
      const {
        fullName,
        avatar,
        citizenship,
        dateOfBirth,
        region,
        area,
        registration,
        fact,
        email,
        phone,
      } = store.state.users.find((item) => item.INN === INNVal.value);
      const [a, b, c] = fullName.split(" ");

      setTimeout(() => {
        surname.value = a;
        name.value = b;
        lastname.value = c;
        avatarImg.value = avatar;
        isLoading.value = false;
        streetSecond.value = fact.street;
        houseSecond.value = fact.house;
        flatSecond.value = fact.flat;
        streetFirst.value = registration.street;
        houseFirst.value = registration.house;
        flatFirst.value = registration.flat;
        citizenshipActiveOption.value = citizenship;
        regionActiveOption.value = region;
        regionActiveOptionSecond.value = region;
        areaActiveOption.value = area;
        areaActiveOptionSecond.value = area;
        dateOfBirthVal.value = dateOfBirth;
        emailVal.value = email;
        phoneVal.value = phone;
        isLoading.value = false;
      }, 1500);
    } catch {
      isLoading.value = false;
      isErr.value = true;
    }
  } else {
    isLoading.value = false;
    isErr.value = true;
  }
};

const areasFirst = ref([]);
const areasSecond = ref([]);

watch(regionActiveOptionSecond, () => {
  areasSecond.value = data.value[regionActiveOptionSecond.value];
});

watch(regionActiveOption, () => {
  areasFirst.value = data.value[regionActiveOption.value];
});
</script>

<style lang="scss" scoped>
input {
  font-family: "Montserrat", sans-serif;
  font-weight: 400;
  font-size: 16px;
  color: #24334b;
}

.info {
  &__profile {
    display: flex;
    gap: 20px;
  }

  p {
    margin: 0;
  }

  &__avatar {
    img {
      width: 170px;
      height: 227px;
      object-fit: cover;
    }
  }

  &__forms {
    flex: 1;

    display: flex;
    flex-direction: column;
    gap: 15px;

    label {
      p {
        margin-top: 0;
      }
    }
  }
}

.info__check-btn {
  margin-top: 20px;
  background: #1baa75;
  position: relative;

  &:disabled {
    opacity: 0.5;
    cursor: progress;
  }
}

.btn {
  font-family: "Montserrat", sans-serif;
  width: 320px;
  padding: 14px 0;
  border: none;
  color: #fff;
  font-weight: 600;
  font-size: 16px;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
  transition: 0.3s;
}

.dropdown {
  width: 100%;
  position: relative;

  &__select {
    position: absolute;
    top: 100%;
    left: 0;
    background: #fff;
    max-height: 200px;
    overflow-y: auto;
    width: 100%;
    z-index: 10;
    border: 1px solid #1baa75;
    border-top: none;
    box-sizing: border-box;
  }

  &__option {
    color: #24334b;
    margin: 15px;
    cursor: pointer;
  }

  label {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    background: #ffffff;
    border: 1px solid #1baa75;
    padding: 12px 10px;
    box-sizing: border-box;
  }
}

@keyframes round {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

.dropdown.city {
  width: 33%;
  padding: 0;

  p {
    white-space: nowrap;
  }

  label {
    padding: 8px 10px;
  }
}

.layer {
  .info__form--wrapper {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }
}
</style>
